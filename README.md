# Python Control for SIYI A8 Mini Camera

[![Language](https://img.shields.io/badge/Language-Python-blue.svg)](https://www.python.org/)

## Обзор

Этот репозиторий содержит Python-приложение для управления камерой-подвесом **SIYI A8 mini** по протоколу UDP и просмотра её видеопотока RTSP с использованием OpenCV. Проект предоставляет модульный и расширяемый интерфейс для взаимодействия с камерой.

Основная цель - предоставить удобный инструмент для тестирования, интеграции и разработки приложений, использующих камеру SIYI A8 mini.

## Возможности

* **Управление по UDP:** Отправка команд и получение ответов от камеры.
* **Обработка ответов:** Парсинг специфичных ответов камеры (данные ориентации, версии прошивки и т.д.).
* **Видеопоток RTSP:** Отображение видео в реальном времени с использованием OpenCV и многопоточности (`ThreadedCamera`) для неблокирующей работы.
* **Управление с клавиатуры:** (example.py)
    * Движение подвеса (Yaw/Pitch): `W`, `A`, `S`, `D`
    * Переключение режимов подвеса (Lock/Follow/FPV): `L`, `F`, `O`
    * Автоматическое центрирование: `C`
    * Запрос и вывод данных ориентации: `G`
    * Сделать фото (сохранение локально): `P`
    * Выход: `Q`
* **Поддержка команд:** Реализована отправка множества команд (зум, фокус, запись, режимы видео и т.д.).
* **Расчет CRC:** Автоматический расчет и добавление контрольной суммы CRC16 Kermit для команд, где это необходимо.
* **Очистка буфера UDP:** Реализован механизм очистки буфера для получения актуальных ответов на запросы.
* **Модульная структура:** Код разделен на классы для управления соединением (`CameraControl`), управления командами и парсерами (`CameraCommandManager`) и чтения видео (`ThreadedCamera`).

**Проверенное борудование:**

* Камера SIYI A8 mini.
* Камера SIYI A2 mini.

## Использование

1.  **Убедитесь, что камера включена** и доступна в сети по адресу `192.168.144.25`:
    ping 192.168.144.25
3.  **Запустите тестовый скрипт**:
    python example.py
4.  Должно появиться окно OpenCV с видеопотоком камеры.
5.  **Используйте клавиши** (окно OpenCV должно быть активным):
    * `W`: Наклон вверх
    * `S`: Наклон вниз
    * `A`: Поворот влево (Yaw)
    * `D`: Поворот вправо (Yaw)
    * `L`: Режим Lock Mode
    * `F`: Режим FPV Mode
    * `O`: Режим Follow Mode
    * `C`: Центрировать подвес
    * `G`: Запросить и вывести в консоль данные ориентации (Yaw, Pitch, Roll)
    * `P`: Сделать снимок
    * `Q`: Выход из приложения

**Конфигурация:**

* **IP-адрес и порт UDP камеры:** Заданы в `CameraControl.py`. Измените `self.UDP_IP` и `self.UDP_PORT` при необходимости.

## Структура кода

* **`CameraControl.py`:** Класс для низкоуровневого взаимодействия по UDP (создание сокета, отправка, получение, очистка буфера).
* **`CameraCommandManager.py`:** Класс, отвечающий за:
    * Определение байтовых последовательностей команд.
    * Генерацию динамических команд.
    * Высокоуровневые методы для отправки команд.
* **`CommandFormatter.py`:** Класс, отвечающий за: парсинг и форматирование ответов камеры.
* **`ThreadedCamera.py`:** Класс для чтения RTSP-потока в отдельном потоке, чтобы не блокировать основной цикл приложения.

## Масштабируемое управление

Подход назван масштабируемым благодаря модульной структуре:

* Новые команды можно легко добавить в `CameraCommandManager`, не затрагивая `CameraControl`.
* Новые парсеры ответов можно добавить в `CommandFormatter` и связать с командами.
